<div class="min-h-screen bg-gradient-to-b from-emerald-500/10 via-white to-sky-500/10">
  <div class="mx-auto w-full max-w-6xl px-4 py-6 md:py-10">

    <!-- Topbar -->
    <div class="flex flex-col gap-3 rounded-3xl border border-black/10 bg-white/70 p-4 backdrop-blur md:flex-row md:items-center md:justify-between md:p-5">
      <a
        class="inline-flex w-fit items-center gap-2 rounded-2xl border border-black/10 bg-white px-3 py-2 text-[14px] font-extrabold text-stone-900 shadow-sm transition hover:shadow"
        routerLink="/stories"
      >
        <span class="text-lg">←</span>
        رجوع للقصص
      </a>

      <div class="flex flex-wrap items-center gap-2" *ngIf="story">
        <span
          *ngIf="story.domain"
          class="inline-flex items-center rounded-full border border-black/10 bg-emerald-500/10 px-3 py-1 text-[12px] font-extrabold text-stone-900"
        >
          {{ story.domain }}
        </span>

        <span class="text-black/30" *ngIf="story.domain && story.country">•</span>

        <span
          *ngIf="story.country"
          class="inline-flex items-center rounded-full border border-black/10 bg-sky-500/10 px-3 py-1 text-[12px] font-extrabold text-stone-900"
        >
          {{ story.country }}
        </span>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="mt-5 rounded-3xl border border-black/10 bg-white/70 p-6 backdrop-blur">
      <div class="flex items-center gap-3">
        <span class="h-5 w-5 animate-spin rounded-full border-2 border-black/20 border-t-black/60"></span>
        <p class="text-[14px] font-bold text-stone-800">جاري التحميل…</p>
      </div>

      <!-- skeleton -->
      <div class="mt-5 grid gap-4 md:grid-cols-12">
        <div class="md:col-span-7">
          <div class="h-56 w-full animate-pulse rounded-3xl bg-black/5 md:h-72"></div>
        </div>
        <div class="md:col-span-5">
          <div class="h-8 w-3/4 animate-pulse rounded-xl bg-black/5"></div>
          <div class="mt-3 h-4 w-2/3 animate-pulse rounded-xl bg-black/5"></div>
          <div class="mt-3 space-y-2">
            <div class="h-4 w-full animate-pulse rounded-xl bg-black/5"></div>
            <div class="h-4 w-11/12 animate-pulse rounded-xl bg-black/5"></div>
            <div class="h-4 w-10/12 animate-pulse rounded-xl bg-black/5"></div>
          </div>
          <div class="mt-4 flex flex-wrap gap-2">
            <div class="h-8 w-20 animate-pulse rounded-full bg-black/5"></div>
            <div class="h-8 w-24 animate-pulse rounded-full bg-black/5"></div>
            <div class="h-8 w-16 animate-pulse rounded-full bg-black/5"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Error -->
    <div
      *ngIf="!loading && errorMsg"
      class="mt-5 rounded-3xl border border-red-500/20 bg-red-50 p-6"
    >
      <p class="text-[14px] font-bold text-red-700">{{ errorMsg }}</p>

      <button
        class="mt-3 inline-flex items-center gap-2 rounded-2xl border border-red-500/20 bg-white px-4 py-2 text-[13px] font-extrabold text-red-700 shadow-sm transition hover:shadow"
        (click)="retry()"
      >
        إعادة المحاولة
        <i class="pi pi-refresh"></i>
      </button>
    </div>

    <!-- Content -->
    <ng-container *ngIf="!loading && story">

      <!-- Hero -->
      <div class="mt-5 grid gap-5 md:grid-cols-12">
        <!-- Cover -->
        <div class="md:col-span-7">
          <div class="overflow-hidden rounded-3xl border border-black/10 bg-white shadow-sm">
            <img
              class="h-[220px] w-full object-cover md:h-[360px]"
              [src]="story.coverImageUrl || 'assets/stories/story1.jpg'"
              [alt]="story.title"
            />
          </div>
        </div>

        <!-- Text -->
        <div class="md:col-span-5">
          <div class="rounded-3xl border border-black/10 bg-white/80 p-5 shadow-sm backdrop-blur md:p-6">
            <h1 class="text-xl font-extrabold leading-snug text-stone-900 md:text-2xl">
              {{ story.title }}
            </h1>

            <div class="mt-3 flex flex-wrap items-center gap-2 text-[13px] font-bold text-stone-700">
              <span *ngIf="story.personName" class="rounded-full bg-black/5 px-3 py-1">
                {{ story.personName }}
              </span>

              <span *ngIf="story.personName && story.highlight" class="text-black/30">•</span>

              <span
                *ngIf="story.highlight"
                class="rounded-full border border-black/10 bg-gradient-to-l from-emerald-500/10 via-white to-sky-500/10 px-3 py-1 text-stone-900"
              >
                {{ story.highlight }}
              </span>
            </div>

            <p *ngIf="story.summary" class="mt-4 text-[14px] leading-7 text-stone-700">
              {{ story.summary }}
            </p>

            <!-- Tags -->
            <div class="mt-4 flex flex-wrap gap-2" *ngIf="tags.length">
              <span
                class="inline-flex items-center rounded-full border border-black/10 bg-white px-3 py-1 text-[12px] font-extrabold text-stone-800"
                *ngFor="let t of tags"
              >
                {{ t }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Media -->
      <section class="mt-6" *ngIf="hasMedia">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-extrabold text-stone-900">وسائط القصة</h2>
        </div>

        <div class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          <div
            class="rounded-3xl border border-black/10 bg-white/80 p-4 shadow-sm backdrop-blur transition hover:shadow"
            *ngFor="let m of story.media; trackBy: trackMedia"
          >
            <div class="mb-3 flex items-start justify-between gap-3">
              <div class="min-w-0">
                <div class="truncate text-[13px] font-extrabold text-stone-900">
                  {{ m.title || 'عنصر' }}
                </div>
                <div class="mt-1 inline-flex rounded-full bg-black/5 px-3 py-1 text-[11px] font-extrabold text-stone-700">
                  {{ m.kind }}
                </div>
              </div>
            </div>

            <!-- image -->
            <ng-container *ngIf="isImage(m); else notImage">
              <img
                class="h-44 w-full rounded-2xl object-cover"
                [src]="m.url || 'https://placehold.co/900x600/png?text=Media'"
                [alt]="m.title || story.title"
              />
            </ng-container>

            <ng-template #notImage>
              <!-- video -->
              <ng-container *ngIf="isVideo(m); else linkMedia">
                <video class="h-44 w-full rounded-2xl bg-black/5" controls [src]="m.url"></video>
              </ng-container>

              <!-- link -->
              <ng-template #linkMedia>
                <a
                  class="mt-2 inline-flex w-full items-center justify-center gap-2 rounded-2xl border border-black/10
                         bg-gradient-to-l from-emerald-500/10 via-white to-sky-500/10
                         px-4 py-3 text-[13px] font-extrabold text-stone-900 shadow-sm transition hover:shadow"
                  [href]="m.url"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  فتح الرابط
                  <i class="pi pi-external-link"></i>
                </a>
              </ng-template>
            </ng-template>
          </div>
        </div>
      </section>

      <!-- Footer info -->
      <section class="mt-6" *ngIf="story.createdAtUtc || story.submittedByName">
        <div class="rounded-3xl border border-black/10 bg-white/70 p-4 backdrop-blur md:p-5">
          <div class="grid gap-4 md:grid-cols-2">
            <div *ngIf="story.submittedByName" class="rounded-2xl bg-black/5 p-4">
              <div class="text-[12px] font-extrabold text-stone-700">إعداد المحتوى</div>
              <div class="mt-1 text-[14px] font-extrabold text-stone-900">{{ story.submittedByName }}</div>
            </div>

            <div *ngIf="story.createdAtUtc" class="rounded-2xl bg-black/5 p-4">
              <div class="text-[12px] font-extrabold text-stone-700">تاريخ الإضافة</div>
              <div class="mt-1 text-[14px] font-extrabold text-stone-900">
                {{ story.createdAtUtc | date: 'mediumDate' }}
              </div>
            </div>
          </div>
        </div>
      </section>

    </ng-container>
  </div>
</div>
